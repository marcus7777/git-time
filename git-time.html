<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../polymer/polymer.html">
<!--
`<git-time></git-time>` # git-time
takes in a git log and outputs amount of time spent on a project with 15 minutes at the Beginning commit to the last commit within a 2 hour period during the time spent on project

@demo demo.html
-->

<dom-module id="git-time">
<template>
<iron-ajax auto url="{{gitLogUrl}}" handle-as="text" last-response="{{gitlog}}"></iron-ajax>
<a title="{{title}}">{{hours}}</a>
</template>
</dom-module>
<script>
Polymer({
  is: "git-time",
  properties: {
    url: String,
    time: {
      computed: "getTime(gitlog)",
      notify: true
    }
  },
  getTime: function(gitlog) {
    var time
    var listOfUsersCommits = {}
    var commitList = gitlog.split('\x00')
    for (var index = 0; index < commitList.length; ++index) {
      var re = /^committer[^<]*<([^>]*)> ([0-9]*)/gm
      var m;
 
      while ((m = re.exec(commitList[index])) !== null) {
        if (m.index === re.lastIndex) {
          re.lastIndex++;
        }
        if (listOfUsersCommits[m[1]]) {
          listOfUsersCommits[m[1]].push(m[2])
        } else {
          listOfUsersCommits[m[1]] = [m[2]]
        } 
      }
    }    
    
    for (committer in listOfUsersCommits) {
      listOfUsersCommits[committer] 
    }
    // work out the person how much time is spent on the project
    return time
  }
})
</script>
